var user = req.query.user;
    var currentUser = req.user;
    var shipment = req.query.shipment;
    // console.log(user);
    // console.log(currentUser._id);
    
    if( user != currentUser._id){
        res.redirect('/index');
    }
    else{
        if(req.session.cart == null){
            res.redirect('/want2wear/shoppingcart') ;
        }
        else{
            
          var promise1 =  User.findById(currentUser).exec()
          .then(function(foundUser){
                
                        
                        Order.create({User : foundUser,shipmentType : shipment}).then( async addnewUser => {
                            // console.log(addnewUser);
                            

                            async function main(){
                                var newProduct = [];
                                var cart = new Cart(req.session.cart ? req.session.cart : {items: {}}); 
                                // console.log(cart);
                                var data = cart.generateArray();
                                let promises = await (data.map( function(stock){
                                       return Stock.findById(stock.item.options).populate('productID size colors').exec().then(function(details){
                                        
                                                                newProduct.push({details:details,qty:stock.qty, price:stock.price });   
                                                                 return newProduct;
                                    });   
                                }));
                                Promise.all(promises).then(async function(results){

                                    async function addPurchase() {
                                        // let addPurchase = [];
                                       let newPromise = await (results[0].map(function(product){
                                            var qty = product.qty;
                                            var price = product.price;
                                            var stock = product.details._id;
                                            // console.log(stock);
                                                const purchase = new Purchase({
                                                    PurchaseItem: stock,
                                                    PurchaseQty: qty,
                                                    PurchasePrice: price,
                                                    
                                                });
                                                purchase.save()
                                                .then( async result => {
                                                    // console.log(result._id);
                                                    addnewUser.Purchase.push(result._id);
                                                    
                                                    
                                                    
                                                })
                                                .catch( err => {
                                                    console.log(err);
                                                });
         
                                        }));

                                        Promise.all(newPromise).then( success => {
                                            console.log(success);
                                        })
                                        
                                        
                                        
                                        // return addPurchase;
                                    }

                                    addPurchase().then( addAlready =>{
                                       console.log(addAlready);
                                  
                                    })
                                    .catch( err => {
                                        console.log(err);
                                    })
                                    
                                    
                                    
                                        
                                        
                                            
                                        
                                //     addnewUser.save().then( addPurchase => {
                                //         console.log(addPurchase);
                                // })
                                    
                                });
                            }
                            
                            
                
                            main()
                            .then( user => {
                                User.findById(currentUser).exec().then( foundUser => {
                                        foundUser.Order.push(addnewUser);
                                        foundUser.save()
                                        .then( UpdateUser => {
                                    // console.log(UpdateUser);
                                            delete req.session.cart;
                                            res.redirect('/index');
                                        })
                                
                                
                                });
                            })
                            .catch(err =>{
                                console.log(err);
                            })
                            
                        });
                        
                
           });

            
        }

    }


/want2wear/delete/<%= product._id %>?_method=DELETE"

<form id="modifyCart" >
                          <button type="submit" id="love" value="add"  >   +   </button>
                        <!-- <a href="/want2wear/shoppingcart/update/<%= product.details._id %>?action=decrese"  >- </a> -->
                        <br>
                          <!-- <a href="/want2wear/shoppingcart/update/<%= product.details._id %>?action=delete" >Remove</a> -->
                          <input type="hidden" value="<%= product.details._id %>" id="productID"  >          
                  </form>


<% order.Order.forEach(function(orderlist){ %>
                
                <% orderlist.Purchase.forEach(function(purchaselist){ %>
                    <% purchaselist.PurchaseItem.forEach(function(productlist){ %>
                        <%= productlist %>
                        <br>

                    <% }); %>

                <br>
                <% }); %>
            <% }); %>
            
            

  <div class="basket">
     
                <div class="basket-labels">
                  <ul>
                    <li class="item item-heading">Item</li>
                    <li class="price">Price</li>
                    <li class="quantity">Quantity</li>
                    <li class="subtotal">Subtotal</li>
                  </ul>
                </div>
                <% order.Order.forEach(function(orderlist){ %>
                    <% orderlist.Purchase.forEach(function(purchaselist){ %>
                        <% purchaselist.PurchaseItem.forEach(function(productlist){ %>
                            <% productlist.productID.forEach(function(product){ %>

                <div class="basket-product">
                  <div class="item">
                    <div class="product-image">
                      <img src="<%= product.image %>" alt="Placholder Image 2" class="product-frame">
                    </div>
                    <div class="product-details">
                      <h1><strong><span class="item-quantity">4</span> x <a href="/want2wear/<%= product._id %>"><%= product.ProductName %> </a></strong></h1>
                      <p><strong>Green, Size xs</strong></p>
                     
                    </div>
                  </div>
                  <div class="price">26</div>
                  <div class="quantity">4</div>
                  
                  <div class="subtotal">104.00</div>
               
                  <div class="review">
                    <a href="detail.html"><button>Review</button> </a>
                  </div>
                </div>
            
               
             
              </div>


---------------------------

router.delete("/want2wear/delete/:id" , function(req,res,next){ 
    
    console.log(req.params.id);
    res.redirect('/index');
    // Product.findById(req.params.id).exec().then( product => {
    //     console.log(product.categories);
    // })
    // .catch(err => {
    //     console.log(err);
    // });
    // Product.findByIdAndRemove(req.params.id, function(err,product){
    //     if(err){
    //         console.log(err);
    //     }
    //     else{
    //         Category.find
            
    //             res.redirect('/want2wear/category');
        
            
    //     }
    // });
   
});

<% allProduct.map(function(product){ %>
            <%= product.ProductName %>
            <br>
            <%= product.image %>
            <br>
            <% product.stock.map(function(stock){ %>
                
                <% stock.size.map(function(size){ %>
                    <%= size.sizeName %>
                <% }); 
                
                stock.colors.map(function(color){ %>
                    <%= color.colorName %>
                <% }); %>
    
                <%= stock.quantity %>
                <br>
            <% }); %>

<% allProduct.map(function(product){ %>
            
            <br>
            
            <br>
            
        <tr>
          <td><button>VIEW</button>
              <button>EDIT</button>
              <button>DEL</button>
              
          </td>
          <td><%= product.ProductName %></td>
          <td><img src="<%= product.image %>" alt="Placholder Image 2" class="product-frame">
            <% product.categories.map(function(category){ %>
                <%= category.categoryName %>
          <% }); %></td>
          
        </tr>
        <% }); %>

<span><img src=<%= product.image %> ></span><br>
        <span>Product Name : <%= product.ProductName %></span><br>
       
       
       <span><% product.categories.map( category =>{ %>
                Category : <%= category.categoryName %>
        <% }); %></span><br>

        <span>Price : <%= product.price %></span><br>
        <!-- <span>Details : <%= product.details %></span><br> -->
        <span>Continue : <%= product.continue %></span><br>
